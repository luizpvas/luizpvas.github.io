<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Controllers and views</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body class="bg-slate-100">
    <main class="max-w-screen-md mx-4 lg:mx-auto pt-4">
      <a href="index.html" class="inline-flex items-center bg-slate-200 hover:bg-slate-300 px-3 py-1 rounded-full">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
        </svg>

        <span class="ml-1">All posts</span>
      </a>

      <div class="border-b-2 mb-4">
        <h1 class="my-6 text-5xl tracking-tight">Controllers and views</h1>
        <div class="text-slate-500 my-2">Published on 2023-08-31</div>
      </div>

      <div class="prose lg:prose-xl mb-12">
        <p>In server-side rendered web applications, views are functions <code>args -&gt; string</code>. Controllers are functions <code>untrusted_args -&gt; string</code>. Controllers authorize the request, validate inputs, run some queries, etc. and then respond with a <code>render</code> call.</p>

<p>Controllers are responsible for gathering and providing the data needed <strong>for a specific view</strong>, with the specific names and fields the view requires. Even though the controller does not care about how things look visually and how they&#39;re arranged, it has to know about the shape of the data.</p>

<p>But the dependency goes both ways. Views know about controllers just as much as controllers know about views.
You can&#39;t just change the endpoint of a form and expected the app to continue working.
You can&#39;t just remove a field from a form and expected the app to continue working.</p>

<p>Forms are designed to submit data to one specific endpoint.
Controllers are designed to render one specified view.</p>

<p>Think about how often you have to change both of them in the same pull request.</p>

<ul>
<li>You add a new field that you read, validate and store.</li>
<li>You change a value to a list of values and validation has to change.</li>
<li>You add some hidden inputs to pass around a parameter needed by some endpoint down the line.</li>
</ul>

<h3>Code that changes together should be close together</h3>

<p>Controllers and views are indeed different abstractions, but they&#39;re tightly coupled.</p>

<p>Here is a rule of thumb for all software: code that changes together should be close together. If that sounds similar to the S principle in SOLID, it does because it is. Code that changes together should be in the same file. Files that change together should be in the same directory. You should be able to look at the directory structure of your app and understand what is is about, what it does, what things are related to what things.</p>

<p>Here&#39;s an example of a pull request overview with the opposite idea of &quot;code that changes together should be close together&quot;:</p>

<pre><code class="bash">my_app/
  controllers/
    payments/
      invoice_controller.rb # (+10 lines)
  validators/
    payments/
       invoice_validator.rb # (+18 lines, -1 line)
  serializers/
    payments/
      invoice_serializer.rb # (+3 lines, -2 lines)
  models/
    payments/
      invoice.rb # (+1 line)
  views/
    payments/
      invoices/
        new.html.erb # (+29 lines)
</code></pre>

<p>All those abstractions look like they&#39;re about the same concept, don&#39;t they? Why do we insist in putting them so far apart from each other?</p>

<h3>Controllers and views next to each other</h3>

<p>Here&#39;s a Rails trick you can use to place controllers and views next to each other: <a href="https://api.rubyonrails.org/v7.0/classes/ActionView/ViewPaths/ClassMethods.html#method-i-prepend_view_path"><code>prepend_view_path</code></a>.</p>

<pre><code class="ruby">class ApplicationController &lt; ActionController::Base
  prepend_view_path Rails.root.join(&quot;app/controllers&quot;)
end
</code></pre>

<p>You can now place your views in the same directory.</p>

<pre><code>  app/
    controllers/
      payments/
        invoices/
          index.html.erb
          new.html.erb
          create.turbo-stream.erb
        invoices_controller.rb
</code></pre>

      </div>
    </main>
  </body>
</html>
