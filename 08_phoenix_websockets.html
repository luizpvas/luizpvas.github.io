<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Phoenix websockets</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body class="bg-slate-100 dark:bg-slate-800 dark:text-white">
    <main class="max-w-screen-md mx-4 lg:mx-auto pt-4">
      <a href="index.html" class="inline-flex border dark:border-slate-900 items-center bg-slate-200 dark:bg-slate-700 hover:border-blue-500 px-3 py-1 rounded-full">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
        </svg>

        <span class="ml-1">All posts</span>
      </a>

      <div class="border-b-2 dark:border-slate-900 mb-4">
        <h1 class="my-6 text-5xl tracking-tight">Phoenix websockets</h1>
        <div class="text-slate-500 dark:text-slate-300 my-2">Published on 2023-10-01</div>
      </div>

      <div class="prose dark:prose-invert lg:prose-xl mb-12">
        <h4>How much memory does an idle connection take?</h4>

<p>Difficult to measure, but seems to be around 33kb.</p>

<table><thead>
<tr>
<th style="text-align: center">Amount of connections</th>
<th style="text-align: center">VM Mem</th>
<th style="text-align: center">VM Mem increase</th>
<th style="text-align: center">Avg per connection</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center">0</td>
<td style="text-align: center">68.2mb</td>
<td style="text-align: center">--</td>
<td style="text-align: center">--</td>
</tr>
<tr>
<td style="text-align: center">40</td>
<td style="text-align: center">69.5mb</td>
<td style="text-align: center">+1.3mb</td>
<td style="text-align: center">32kb</td>
</tr>
<tr>
<td style="text-align: center">80</td>
<td style="text-align: center">70.9mb</td>
<td style="text-align: center">+1.4mb</td>
<td style="text-align: center">33kb</td>
</tr>
<tr>
<td style="text-align: center">120</td>
<td style="text-align: center">72.3mb</td>
<td style="text-align: center">+1.4mb</td>
<td style="text-align: center">33kb</td>
</tr>
<tr>
<td style="text-align: center">160</td>
<td style="text-align: center">73.8mb</td>
<td style="text-align: center">+1.5mb</td>
<td style="text-align: center">34kb</td>
</tr>
<tr>
<td style="text-align: center">200</td>
<td style="text-align: center">74.5mb</td>
<td style="text-align: center">+0.7mb</td>
<td style="text-align: center">31kb</td>
</tr>
<tr>
<td style="text-align: center"><em>disconnect all</em></td>
<td style="text-align: center">68.3mb</td>
<td style="text-align: center">-6.3mb</td>
<td style="text-align: center">--</td>
</tr>
</tbody></table>

<p><img src="images/09_memory.png" alt="chart with the same information as the table above">
<em>Arrows indicate the moment for each burst of 40 connections.</em></p>

<h4>How much memory does it take to broadcast a message?</h4>

<p>Even more difficult to measure. Here&#39;s what I did:</p>

<ul>
<li>20 connect users.</li>
<li>1 broadcasts to 2, 2 broadcasts to 1. 3 broadcasts to 4, 4 broadcasts to 3. And so on.</li>
<li>All users broadcast a &quot;Hello world&quot; message every 500ms to the connected partner. Total 40 broadcats per second.</li>
</ul>

<p><img src="images/09_broadcasts.png" alt="chart with memory usage during broadcast"></p>

<p><em>The first arrow shows the moment 20 users connected. Second arrow shows the moment broadcasting started. Rectangle shows the duration of the broadcasting</em></p>

      </div>
    </main>
  </body>
</html>
